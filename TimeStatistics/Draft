import win32gui
import time
from datetime import date
import datetime
import os.path
from os import path

currentActivities=[]
activityCounter=[]
fullString=[]

#Getting the current date, used for file naming conventions
dateString=str(date.today())
print(f"{dateString}")

#If a file already exists for today, use that file to import prior activities
if path.exists(f"{dateString}.txt"):
    with open(f"{dateString}.txt", 'r') as fillList:
        for i in fillList.readlines():
            splitImport=i.split("::")
            if splitImport[0] not in currentActivities:
                currentActivities.append(splitImport[0])
                activityCounter.append(1)
            elif splitImport[0] in currentActivities:
                activityCounter[currentActivities.index(splitImport[0])]=splitImport[1]

    print(f"Current activities: {currentActivities}")

#Otherwise create a new one
else:
    open(f"{dateString}.txt", 'x')
    print("It doesn't exist")

if not currentActivities:
    fullString.append(f"{win32gui.GetWindowText(win32gui.GetForegroundWindow())}::1")

while True:
    currentWindow=str(f"{win32gui.GetWindowText(win32gui.GetForegroundWindow())}")

#Using the file from today, read each line. If it's not in current activities, add it and create a new entry
    with open(f"{dateString}.txt", 'r') as readList:

        importList=readList.readlines()
        for i in importList:
            splitReadList=i.strip('\n')
            splitReadList=splitReadList.split("::")
            if currentWindow not in splitReadList[0]:
                with open(f"{dateString}.txt", 'a') as writeList:
                    writeList.write(f"{currentWindow}::1")
                    importList=readList.readlines()

    if currentWindow not in currentActivities:
            currentActivities.append(currentWindow)
            activityCounter.append(1)
            print(f"Current Activities: {currentActivities}")
            fullString.append(f"{currentWindow}::1")
            #Otherwise incriment the value by 1
    elif currentWindow in currentActivities:
        print("Adding")
        arraySpot=currentActivities.index(currentWindow)
        print(f"Array Spot: {arraySpot}")
        fString=f"{currentWindow}::{activityCounter[arraySpot]}"
        print(f"Activity counter: {activityCounter[arraySpot]}")
        activityCounter[arraySpot]=int(activityCounter[arraySpot])+1

        fStringSplit=fullString[fullString.index(fString)].split("::")
        fStringSplit[1]=int(fStringSplit[1])+1
        fullString[fullString.index(fString)]=f"{fStringSplit[0]}::{fStringSplit[1]}"

    print(f"FullString: {fullString}")
    with open(f"{dateString}.txt",'w') as writeList:
        for i in fullString:
            writeList.write(f"{i}\n")
    #  print(f"Current activities: {currentActivities[0]}")
    #print(f"Current Window: {win32gui.GetWindowText(win32gui.GetForegroundWindow())}")
    #  for i in currentActivities:
    time.sleep(1)